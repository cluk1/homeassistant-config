template:
  - sensor:
      - unique_id: flats_heating_demand
        default_entity_id: sensor.flats_heating_demand
        name: Wohnungen Heizbedarf
        state: >
          {% set temp_actual = states('sensor.flats_avg_temperature') | float %}
          {% set temp_wanted = ( states('input_number.flat_temperature_setpoint') | float - states('input_number.flat_temperature_tolerance') | float ) %}
          {{ (temp_wanted - temp_actual) | round(1, "half", default=0) }}
      - unique_id: heatpump_currentoutputpower
        default_entity_id: sensor.heatpump_currentoutputpower
        name: "Heatpump Output Power"
        device_class: power
        unit_of_measurement: kW
        state: >
          {{ states('sensor.ebusd_hmu_currentconsumedpower_value')|float + states('sensor.ebusd_hmu_currentyieldpower_value')|float }}
      - unique_id: heatpump_cop
        default_entity_id: sensor.heatpump_cop
        name: "Heatpump CoP"
        device_class: power_factor
        state: >
          {{ ( states('sensor.heatpump_currentoutputpower')|float / states('sensor.ebusd_hmu_currentconsumedpower_value')|float ) }}
  - binary_sensor:
      - unique_id: flat1_humidity_too_high
        default_entity_id: binary_sensor.flat1_humidity_too_high
        name: "Wohnung 1 Luftfeuchte"
        state: >
          {{ states('sensor.juengst_luftfeuchtigkeit')|float >= states("input_number.flat_humidity_alert")|float }}
      - unique_id: flat2_humidity_too_high
        default_entity_id: binary_sensor.flat2_humidity_too_high
        name: "Wohnung 2 Luftfeuchte"
        state: >
          {{ states('sensor.nunnenmacher_luftfeuchtigkeit')|float >= states("input_number.flat_humidity_alert")|float }}
      - unique_id: flat3_humidity_too_high
        default_entity_id: binary_sensor.flat3_humidity_too_high
        name: "Wohnung 3 Luftfeuchte"
        state: >
          {{ states('sensor.ketterer_luftfeuchtigkeit')|float >= states("input_number.flat_humidity_alert")|float }}
